@page "/"
@using AssetHubBlazor.Models
@using AssetHubBlazor.Services
@inject AssetService AssetService

<div class="dashboard-title-section">
    <h1 class="dashboard-title">GLOBAL ASSET OVERVIEW</h1>
    <p class="dashboard-subtitle">Monitor and manage assets efficiently. View real-time data and trends.</p>
</div>

<div class="card-row summary-cards">
    <div class="summary-card">
        <div class="card-icon"><span class="bi bi-boxes"></span></div>
        <div class="card-value">@TotalAssets</div>
        <div class="card-label">Total Assets</div>
        <div class="card-change positive">+5.16% from 30d ago</div>
    </div>
    <div class="summary-card">
        <div class="card-icon"><span class="bi bi-tools"></span></div>
        <div class="card-value">@InUseCount</div>
        <div class="card-label">In Use</div>
        <div class="card-change positive">+4.73% from 30d ago</div>
    </div>
    <div class="summary-card">
        <div class="card-icon"><span class="bi bi-check-circle"></span></div>
        <div class="card-value">@AvailableCount</div>
        <div class="card-label">Available</div>
        <div class="card-change negative">-2.50% from 30d ago</div>
    </div>
    <div class="summary-card">
        <div class="card-icon"><span class="bi bi-currency-dollar"></span></div>
        <div class="card-value">$15.75K</div>
        <div class="card-label">Avg. Value</div>
        <div class="card-change positive">+5.16% from 30d ago</div>
    </div>
</div>

<div class="dashboard-graphs-row">
    <div class="dashboard-graph dashboard-graph-left">
        <div class="graph-header">
            <span class="graph-title">TOTAL ASSET VALUE</span>
            <div class="graph-tabs">
                <span class="graph-tab active">Daily</span>
                <span class="graph-tab">Weekly</span>
                <span class="graph-tab">Monthly</span>
            </div>
        </div>
        <canvas id="lineChart"></canvas>
        <div class="graph-legend">
            <span class="legend-dot yellow"></span> Purchases
            <span class="legend-dot green"></span> Usage
            <span class="legend-dot red"></span> Losses
            <span class="legend-dot pink"></span> Maintenance
        </div>
    </div>
    <div class="dashboard-graph dashboard-graph-right">
        <div class="graph-header">
            <span class="graph-title">TOTAL ASSET VALUE</span>
        </div>
        <canvas id="bubbleChart"></canvas>
        <div class="graph-metrics">
            <span class="metric-label">Total Value:</span>
            <span class="metric-value">$45.08K</span>
            <span class="legend-dot purple"></span> $37.08K In Use
            <span class="legend-dot green"></span> $5.00K Available
        </div>
    </div>
</div>

<div class="dashboard-bottom-row">
    <div class="dashboard-table-section">
        <div class="table-header">
            <span class="table-title">RECENT ASSETS</span>
            <div class="table-tabs">
                <span class="table-tab active">All</span>
                <span class="table-tab">In Use</span>
                <span class="table-tab">Available</span>
            </div>
        </div>
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Type</th>
                    <th>Status</th>
                    <th>Purchase Date</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Laptop A1</td>
                    <td>Electronics</td>
                    <td><span class="badge bg-success">In Use</span></td>
                    <td>2023-06-15</td>
                    <td>
                        <button class="btn btn-sm btn-gradient"><span class="bi bi-pencil"></span></button>
                        <button class="btn btn-sm btn-gradient"><span class="bi bi-trash"></span></button>
                    </td>
                </tr>
                <tr>
                    <td>Desk B2</td>
                    <td>Furniture</td>
                    <td><span class="badge bg-secondary">Available</span></td>
                    <td>2023-05-20</td>
                    <td>
                        <button class="btn btn-sm btn-gradient"><span class="bi bi-pencil"></span></button>
                        <button class="btn btn-sm btn-gradient"><span class="bi bi-trash"></span></button>
                    </td>
                </tr>
                @foreach (var asset in RecentAssets)
                {
                    <tr>
                        <td>@asset.Name</td>
                        <td>@asset.Type</td>
                        <td>
                            <span class="badge @(asset.Status == Status.InUse ? "bg-success" : "bg-secondary")">
                                @asset.Status
                            </span>
                        </td>
                        <td>@asset.PurchaseDate.ToString("MMM dd")</td>
                        <td>
                            <a href="/view/@asset.Id" class="btn btn-sm btn-gradient"><span class="bi bi-pencil"></span></a>
                            <a href="/edit/@asset.Id" class="btn btn-sm btn-gradient"><span class="bi bi-trash"></span></a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
<div class="dashboard-news-section mt-4">
    <div class="news-header">
        <span class="news-title">LATEST UPDATES</span>
    </div>
    <div class="news-list">
        <div class="news-item">
            <span class="bi bi-info-circle"></span>
            <span class="news-headline">New asset tracking feature released...</span>
            <a href="#" class="news-link">Learn More</a>
        </div>
        <div class="news-item">
            <span class="bi bi-info-circle"></span>
            <span class="news-headline">Maintenance schedule updated...</span>
            <a href="#" class="news-link">Learn More</a>
        </div>
        <div class="news-item">
            <span class="bi bi-info-circle"></span>
            <span class="news-headline">Asset value analytics improved...</span>
            <a href="#" class="news-link">Learn More</a>
        </div>
        <div class="news-item">
            <span class="bi bi-info-circle"></span>
            <span class="news-headline">Security update for asset data...</span>
            <a href="#" class="news-link">Learn More</a>
        </div>
    </div>
    <button class="btn btn-primary view-all-btn">
        View All <span class="bi bi-arrow-right"></span>
    </button>
</div>

@code {
    private List<Asset> AllAssets = new();
    private List<Asset> RecentAssets => AllAssets
        .OrderByDescending(a => a.PurchaseDate)
        .Take(20)
        .ToList();

    protected override async Task OnInitializedAsync()
    {
        AllAssets = await AssetService.GetAllAsync();
    }

    private int TotalAssets => AllAssets.Count;
    private int InUseCount => AllAssets.Count(a => a.Status == Status.InUse);
    private int AvailableCount => AllAssets.Count(a => a.Status == Status.Available);

    private int LaptopCount => AllAssets.Count(a => a.Type == AssetType.Laptop);
    private int PhoneCount => AllAssets.Count(a => a.Type == AssetType.Phone);
    private int MonitorCount => AllAssets.Count(a => a.Type == AssetType.Monitor);

    private decimal AverageValue => AllAssets.Any() ? AllAssets.Average(a => a.PurchasePrice) : 0;

    private string ActiveBottomTab = "assets";
}